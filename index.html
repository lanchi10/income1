<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מעקב הכנסות חודשיות</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 2rem;
            margin-bottom: 2rem;
        }
        .income-item {
            background: #f8fafc;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }
        .income-item:hover {
            border-color: #3b82f6;
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.1);
        }
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #1d4ed8, #1e3a8a);
            transform: translateY(-2px);
        }
        .btn-edit {
            background: #10b981;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn-edit:hover {
            background: #059669;
        }
        .btn-delete {
            background: #ef4444;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn-delete:hover {
            background: #dc2626;
        }
        input, select {
            background: white !important;
            color: #1f2937 !important;
            border: 2px solid #d1d5db !important;
            border-radius: 8px;
            padding: 0.75rem;
            width: 100%;
            transition: border-color 0.3s ease;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #3b82f6 !important;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        label {
            color: #374151 !important;
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: block;
        }
        .checkbox-container {
            display: flex;
            align-items: center;
            background: white;
            padding: 0.75rem;
            border: 2px solid #d1d5db;
            border-radius: 8px;
            cursor: pointer;
            transition: border-color 0.3s ease;
        }
        .checkbox-container:hover {
            border-color: #3b82f6;
        }
        .checkbox-container input[type="checkbox"] {
            width: 20px !important;
            height: 20px !important;
            margin-left: 0.75rem;
            accent-color: #3b82f6;
            cursor: pointer;
        }
        .checkbox-container label {
            color: #374151 !important;
            margin: 0;
            cursor: pointer;
            flex: 1;
        }
        .report-section {
            background: #f0f9ff;
            border: 2px solid #bae6fd;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        .total-amount {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
            font-size: 1.25rem;
            font-weight: bold;
            margin-bottom: 1rem;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 2rem;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }
        .close {
            color: #aaa;
            float: left;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close:hover {
            color: #000;
        }
        .tab-button {
            background: #e5e7eb;
            color: #374151;
            padding: 0.75rem 1.5rem;
            border: none;
            cursor: pointer;
            border-radius: 8px 8px 0 0;
            margin-left: 2px;
            transition: all 0.3s ease;
        }
        .tab-button.active {
            background: #3b82f6;
            color: white;
        }
        .tab-content {
            display: none;
            background: white;
            padding: 2rem;
            border-radius: 0 15px 15px 15px;
        }
        .tab-content.active {
            display: block;
        }
        .print-friendly {
            break-inside: avoid;
        }
    </style>
</head>
<body>
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white mb-4">
                <i class="fas fa-chart-line ml-2"></i>
                מעקב הכנסות חודשיות
            </h1>
            <p class="text-blue-100 text-lg">ניהול ומעקב אחר ההכנסות שלך בצורה פשוטה ויעילה</p>
        </div>

        <!-- הגדרות מקורות הכנסה -->
        <div class="card print-friendly">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <i class="fas fa-cog ml-2"></i>
                הגדרות מקורות הכנסה
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label>מקור הכנסה 1:</label>
                    <input type="text" id="source1Name" placeholder="טיפולים פרטיים" value="טיפולים פרטיים">
                </div>
                <div>
                    <label>מקור הכנסה 2:</label>
                    <input type="text" id="source2Name" placeholder="גן תל השומר" value="גן תל השומר">
                </div>
                <div>
                    <label>מקור הכנסה 3:</label>
                    <input type="text" id="source3Name" placeholder="שונות" value="שונות">
                </div>
            </div>
            <button onclick="updateSourceNames()" class="btn-primary mt-4">
                <i class="fas fa-save ml-1"></i>
                שמור שמות מקורות
            </button>
        </div>

        <!-- הוספת הכנסה -->
        <div class="card print-friendly">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <i class="fas fa-plus-circle ml-2"></i>
                הוספת הכנסה חדשה
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <div>
                    <label>תאריך:</label>
                    <input type="date" id="incomeDate">
                </div>
                <div>
                    <label>מקור הכנסה:</label>
                    <select id="incomeSource">
                        <option value="source1">טיפולים פרטיים</option>
                        <option value="source2">גן תל השומר</option>
                        <option value="source3">שונות</option>
                    </select>
                </div>
                <div>
                    <label>סכום (₪):</label>
                    <input type="number" id="incomeAmount" placeholder="0" step="0.01">
                </div>
                <div>
                    <div class="checkbox-container">
                        <label>הכנסה קבועה</label>
                        <input type="checkbox" id="isFixed">
                    </div>
                </div>
            </div>
            <button onclick="addIncome()" class="btn-primary mt-4">
                <i class="fas fa-plus ml-1"></i>
                הוסף הכנסה
            </button>
        </div>

        <!-- רשימת הכנסות -->
        <div class="card print-friendly">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <i class="fas fa-list ml-2"></i>
                רשימת הכנסות
            </h2>
            <div id="incomeList"></div>
        </div>

        <!-- דוחות -->
        <div class="card print-friendly">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <i class="fas fa-chart-bar ml-2"></i>
                דוחות
            </h2>
            
            <div class="flex flex-wrap">
                <button class="tab-button active" onclick="showTab('monthly')">דוח חודשי</button>
                <button class="tab-button" onclick="showTab('yearly')">דוח שנתי</button>
            </div>

            <div id="monthlyTab" class="tab-content active">
                <div class="mb-4">
                    <label>חודש ושנה:</label>
                    <input type="month" id="reportMonth">
                    <button onclick="generateMonthlyReport()" class="btn-primary mr-2">
                        <i class="fas fa-search ml-1"></i>
                        הצג דוח
                    </button>
                </div>
                <div id="monthlyReport"></div>
            </div>

            <div id="yearlyTab" class="tab-content">
                <div class="mb-4">
                    <label>שנה:</label>
                    <input type="number" id="reportYear" min="2020" max="2030">
                    <button onclick="generateYearlyReport()" class="btn-primary mr-2">
                        <i class="fas fa-search ml-1"></i>
                        הצג דוח
                    </button>
                </div>
                <div id="yearlyReport"></div>
            </div>
        </div>
    </div>

    <!-- Modal לעריכת הכנסה -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEditModal()">&times;</span>
            <h2 class="text-xl font-bold text-gray-800 mb-4">עריכת הכנסה</h2>
            <div class="space-y-4">
                <div>
                    <label>תאריך:</label>
                    <input type="date" id="editDate">
                </div>
                <div>
                    <label>מקור הכנסה:</label>
                    <select id="editSource">
                        <option value="source1">טיפולים פרטיים</option>
                        <option value="source2">גן תל השומר</option>
                        <option value="source3">שונות</option>
                    </select>
                </div>
                <div>
                    <label>סכום (₪):</label>
                    <input type="number" id="editAmount" step="0.01">
                </div>
                <div>
                    <div class="checkbox-container">
                        <label>הכנסה קבועה</label>
                        <input type="checkbox" id="editFixed">
                    </div>
                </div>
                <div class="flex gap-2">
                    <button onclick="saveEdit()" class="btn-primary">
                        <i class="fas fa-save ml-1"></i>
                        שמור שינויים
                    </button>
                    <button onclick="closeEditModal()" class="btn-delete">
                        ביטול
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let incomes = JSON.parse(localStorage.getItem('incomes')) || [];
        let sourceNames = JSON.parse(localStorage.getItem('sourceNames')) || {
            source1: 'טיפולים פרטיים',
            source2: 'גן תל השומר',
            source3: 'שונות'
        };
        let editingIndex = -1;

        // אתחול
        window.onload = function() {
            document.getElementById('incomeDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('reportMonth').value = new Date().toISOString().slice(0, 7);
            document.getElementById('reportYear').value = new Date().getFullYear();
            updateSourceNames();
            displayIncomes();
            generateMonthlyReport();
        };

        function updateSourceNames() {
            sourceNames.source1 = document.getElementById('source1Name').value || 'טיפולים פרטיים';
            sourceNames.source2 = document.getElementById('source2Name').value || 'גן תל השומר';
            sourceNames.source3 = document.getElementById('source3Name').value || 'שונות';
            
            localStorage.setItem('sourceNames', JSON.stringify(sourceNames));
            
            // עדכון הסלקט באקסים
            updateSelectOptions();
            displayIncomes();
            
            alert('שמות המקורות נשמרו בהצלחה!');
        }

        function updateSelectOptions() {
            const selects = ['incomeSource', 'editSource'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                select.innerHTML = `
                    <option value="source1">${sourceNames.source1}</option>
                    <option value="source2">${sourceNames.source2}</option>
                    <option value="source3">${sourceNames.source3}</option>
                `;
            });
        }

        function addIncome() {
            const date = document.getElementById('incomeDate').value;
            const source = document.getElementById('incomeSource').value;
            const amount = parseFloat(document.getElementById('incomeAmount').value);
            const isFixed = document.getElementById('isFixed').checked;

            if (!date || !amount || amount <= 0) {
                alert('אנא מלא את כל השדות הנדרשים');
                return;
            }

            const income = {
                id: Date.now(),
                date: date,
                source: source,
                amount: amount,
                isFixed: isFixed
            };

            incomes.push(income);
            saveToStorage();
            displayIncomes();
            clearForm();
            alert('ההכנסה נוספה בהצלחה!');
        }

        function clearForm() {
            document.getElementById('incomeAmount').value = '';
            document.getElementById('isFixed').checked = false;
        }

        function displayIncomes() {
            const list = document.getElementById('incomeList');
            if (incomes.length === 0) {
                list.innerHTML = '<p class="text-gray-500 text-center">אין עדיין הכנסות רשומות</p>';
                return;
            }

            const sortedIncomes = incomes.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            list.innerHTML = sortedIncomes.map((income, index) => `
                <div class="income-item">
                    <div class="flex justify-between items-center">
                        <div class="flex-1">
                            <div class="text-lg font-bold text-gray-800">
                                ${sourceNames[income.source]} - ₪${income.amount.toLocaleString()}
                            </div>
                            <div class="text-sm text-gray-600">
                                תאריך: ${new Date(income.date).toLocaleDateString('he-IL')}
                                ${income.isFixed ? '<span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs mr-2">קבוע</span>' : ''}
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="editIncome(${incomes.indexOf(income)})" class="btn-edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteIncome(${incomes.indexOf(income)})" class="btn-delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function editIncome(index) {
            editingIndex = index;
            const income = incomes[index];
            
            document.getElementById('editDate').value = income.date;
            document.getElementById('editSource').value = income.source;
            document.getElementById('editAmount').value = income.amount;
            document.getElementById('editFixed').checked = income.isFixed;
            
            document.getElementById('editModal').style.display = 'block';
        }

        function saveEdit() {
            if (editingIndex === -1) return;
            
            const date = document.getElementById('editDate').value;
            const source = document.getElementById('editSource').value;
            const amount = parseFloat(document.getElementById('editAmount').value);
            const isFixed = document.getElementById('editFixed').checked;

            if (!date || !amount || amount <= 0) {
                alert('אנא מלא את כל השדות הנדרשים');
                return;
            }

            incomes[editingIndex] = {
                ...incomes[editingIndex],
                date: date,
                source: source,
                amount: amount,
                isFixed: isFixed
            };

            saveToStorage();
            displayIncomes();
            closeEditModal();
            alert('ההכנסה עודכנה בהצלחה!');
        }

        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
            editingIndex = -1;
        }

        function deleteIncome(index) {
            if (confirm('האם אתה בטוח שברצונך למחוק הכנסה זו?')) {
                incomes.splice(index, 1);
                saveToStorage();
                displayIncomes();
                alert('ההכנסה נמחקה בהצלחה!');
            }
        }

        function generateMonthlyReport() {
            const month = document.getElementById('reportMonth').value;
            if (!month) return;

            const [year, monthNum] = month.split('-');
            const monthIncomes = incomes.filter(income => {
                const incomeDate = new Date(income.date);
                return incomeDate.getFullYear() == year && incomeDate.getMonth() == monthNum - 1;
            });

            const report = document.getElementById('monthlyReport');
            
            if (monthIncomes.length === 0) {
                report.innerHTML = '<p class="text-gray-500">אין הכנסות לחודש זה</p>';
                return;
            }

            const totalBySource = {};
            let totalFixed = 0;
            let totalVariable = 0;

            monthIncomes.forEach(income => {
                if (!totalBySource[income.source]) {
                    totalBySource[income.source] = 0;
                }
                totalBySource[income.source] += income.amount;
                
                if (income.isFixed) {
                    totalFixed += income.amount;
                } else {
                    totalVariable += income.amount;
                }
            });

            const total = totalFixed + totalVariable;

            report.innerHTML = `
                <div class="total-amount">
                    סה"כ הכנסות החודש: ₪${total.toLocaleString()}
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div class="bg-green-50 p-4 rounded-lg">
                        <h4 class="font-bold text-green-800">הכנסות קבועות</h4>
                        <p class="text-2xl font-bold text-green-600">₪${totalFixed.toLocaleString()}</p>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h4 class="font-bold text-blue-800">הכנסות משתנות</h4>
                        <p class="text-2xl font-bold text-blue-600">₪${totalVariable.toLocaleString()}</p>
                    </div>
                </div>
                <h4 class="font-bold text-gray-800 mb-2">פילוח לפי מקור:</h4>
                ${Object.entries(totalBySource).map(([source, amount]) => `
                    <div class="flex justify-between items-center bg-gray-50 p-3 rounded mb-2">
                        <span class="font-medium">${sourceNames[source]}</span>
                        <span class="font-bold text-blue-600">₪${amount.toLocaleString()}</span>
                    </div>
                `).join('')}
            `;
        }

        function generateYearlyReport() {
            const year = document.getElementById('reportYear').value;
            if (!year) return;

            const yearIncomes = incomes.filter(income => {
                return new Date(income.date).getFullYear() == year;
            });

            const report = document.getElementById('yearlyReport');
            
            if (yearIncomes.length === 0) {
                report.innerHTML = '<p class="text-gray-500">אין הכנסות לשנה זו</p>';
                return;
            }

            const monthlyTotals = {};
            const sourceYearlyTotals = {};
            let yearlyTotal = 0;

            for (let month = 0; month < 12; month++) {
                monthlyTotals[month] = 0;
            }

            yearIncomes.forEach(income => {
                const month = new Date(income.date).getMonth();
                monthlyTotals[month] += income.amount;
                yearlyTotal += income.amount;
                
                if (!sourceYearlyTotals[income.source]) {
                    sourceYearlyTotals[income.source] = 0;
                }
                sourceYearlyTotals[income.source] += income.amount;
            });

            const monthNames = [
                'ינואר', 'פברואר', 'מרץ', 'אפריל', 'מאי', 'יוני',
                'יולי', 'אוגוסט', 'ספטמבר', 'אוקטובר', 'נובמבר', 'דצמבר'
            ];

            report.innerHTML = `
                <div class="total-amount">
                    סה"כ הכנסות השנה: ₪${yearlyTotal.toLocaleString()}
                </div>
                <h4 class="font-bold text-gray-800 mb-4">פילוח חודשי:</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 mb-6">
                    ${Object.entries(monthlyTotals).map(([month, total]) => `
                        <div class="bg-blue-50 p-3 rounded-lg text-center">
                            <div class="font-medium text-gray-700">${monthNames[month]}</div>
                            <div class="text-lg font-bold text-blue-600">₪${total.toLocaleString()}</div>
                        </div>
                    `).join('')}
                </div>
                <h4 class="font-bold text-gray-800 mb-2">פילוח לפי מקור:</h4>
                ${Object.entries(sourceYearlyTotals).map(([source, amount]) => `
                    <div class="flex justify-between items-center bg-gray-50 p-3 rounded mb-2">
                        <span class="font-medium">${sourceNames[source]}</span>
                        <span class="font-bold text-blue-600">₪${amount.toLocaleString()}</span>
                    </div>
                `).join('')}
            `;
        }

        function showTab(tabName) {
            // הסתר את כל הטאבים
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });

            // הצג את הטאב הנבחר
            document.getElementById(tabName + 'Tab').classList.add('active');
            event.target.classList.add('active');
        }

        function saveToStorage() {
            localStorage.setItem('incomes', JSON.stringify(incomes));
        }

        // סגירת המודל בלחיצה על הרקע
        window.onclick = function(event) {
            const modal = document.getElementById('editModal');
            if (event.target == modal) {
                closeEditModal();
            }
        }
    </script>
</body>
</html>
